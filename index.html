<!-- 
    PGH Risk & Safety Website - Homepage
    This is the main landing page for the Risk & Safety management application.
    It serves as a dashboard overview with safety metrics and quick navigation.
    
    Senior Developer Improvements:
    - Font Awesome icons for visual hierarchy
    - Animated counters for metrics
    - Toast notifications for better UX
    - Professional footer with quick links
    - Accessibility enhancements (ARIA labels)
    - Smooth scroll and page transitions
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PGH Risk & Safety - Professional safety management platform for construction and industrial sites">
    <meta name="theme-color" content="#282828">
    <title>PGH Risk & Safety | Dashboard</title>
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Bootstrap 5.3.0 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome 6 for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner-border text-light" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Toast Container for notifications -->
    <div class="toast-container position-fixed top-0 end-0 p-3" id="toastContainer" aria-live="polite"></div>

    <!-- NAVIGATION BAR -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNavbar" aria-label="Main navigation">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="index.html">
                <i class="fas fa-hard-hat me-2" aria-hidden="true"></i>
                <span>PGH Risk & Safety</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item">
                        <a class="nav-link active" href="index.html" aria-current="page">
                            <i class="fas fa-home me-1"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="photos.html">
                            <i class="fas fa-camera me-1"></i> Photos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="training.html">
                            <i class="fas fa-graduation-cap me-1"></i> Training
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="report.html">
                            <i class="fas fa-exclamation-triangle me-1"></i> Report
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about.html">
                            <i class="fas fa-info-circle me-1"></i> About
                        </a>
                    </li>
                    <li class="nav-item ms-lg-3">
                        <button class="btn btn-outline-light btn-sm" id="darkModeToggle" aria-label="Toggle dark mode">
                            <i class="fas fa-moon"></i>
                        </button>
                    </li>
                    <!-- Auth buttons - dynamic based on login state -->
                    <li class="nav-item ms-lg-2" id="authButtonContainer">
                        <a href="login.html" class="btn btn-warning btn-sm" id="loginBtn">
                            <i class="fas fa-sign-in-alt me-1"></i> Login
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- HERO SECTION -->
    <header class="hero-section d-flex align-items-center" role="banner">
        <div class="container text-center text-white">
            <span class="badge bg-success mb-3 fade-in-up">
                <i class="fas fa-shield-alt me-1"></i> Safety Management Platform
            </span>
            <h1 class="display-3 fw-bold mb-3 fade-in-up" style="animation-delay: 0.1s">
                Safety Starts Here
            </h1>
            <p class="lead mb-4 fade-in-up" style="animation-delay: 0.2s">
                Manage risks, report incidents, and stay trained directly from the jobsite.
            </p>
            <div class="d-flex flex-wrap justify-content-center gap-3 fade-in-up" style="animation-delay: 0.3s">
                <a href="report.html" class="btn btn-danger btn-lg px-4 shadow-lg">
                    <i class="fas fa-exclamation-circle me-2"></i> Report Incident
                </a>
                <a href="photos.html" class="btn btn-success btn-lg px-4 shadow-lg">
                    <i class="fas fa-camera me-2"></i> Upload Photo
                </a>
            </div>
            <div class="scroll-indicator mt-5 fade-in-up" style="animation-delay: 0.5s">
                <a href="#metrics" class="text-white" aria-label="Scroll to metrics">
                    <i class="fas fa-chevron-down fa-2x bounce"></i>
                </a>
            </div>
        </div>
    </header>

    <!-- QUICK STATS BAR -->
    <section class="quick-stats bg-dark text-white py-3">
        <div class="container">
            <div class="row text-center">
                <div class="col-6 col-md-3">
                    <div class="stat-item">
                        <i class="fas fa-users text-info"></i>
                        <span class="stat-number" data-count="247">0</span>
                        <span class="stat-label">Active Workers</span>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="stat-item">
                        <i class="fas fa-building text-warning"></i>
                        <span class="stat-number" data-count="12">0</span>
                        <span class="stat-label">Active Sites</span>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="stat-item">
                        <i class="fas fa-clipboard-check text-success"></i>
                        <span class="stat-number" data-count="98">0</span>
                        <span class="stat-label">% Compliance</span>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="stat-item">
                        <i class="fas fa-calendar-check text-primary"></i>
                        <span class="stat-number" data-count="156">0</span>
                        <span class="stat-label">Safe Days</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SAFETY METRICS SECTION -->
    <section class="container py-5" id="metrics">
        <div class="section-header text-center mb-5">
            <span class="section-badge">
                <i class="fas fa-chart-line me-1"></i> Performance
            </span>
            <h2 class="section-title">Safety Metrics</h2>
            <p class="section-subtitle">Real-time safety performance indicators</p>
        </div>
        
        <div class="row g-4">
            <!-- Incidents Card -->
            <div class="col-md-4">
                <div class="metric-card card h-100 shadow-sm border-0">
                    <div class="card-body text-center p-4">
                        <div class="metric-icon bg-primary-soft text-primary mb-3">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <h3 class="metric-value text-primary counter" data-target="0">0</h3>
                        <p class="metric-label mb-0">Incidents This Month</p>
                        <div class="metric-trend text-success mt-2">
                            <i class="fas fa-arrow-down me-1"></i>
                            <span>0% from last month</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Near Misses Card -->
            <div class="col-md-4">
                <div class="metric-card card h-100 shadow-sm border-0">
                    <div class="card-body text-center p-4">
                        <div class="metric-icon bg-warning-soft text-warning mb-3">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3 class="metric-value text-warning counter" data-target="0">0</h3>
                        <p class="metric-label mb-0">Near Misses Reported</p>
                        <div class="metric-trend text-muted mt-2">
                            <i class="fas fa-minus me-1"></i>
                            <span>No change</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Safety Status Card -->
            <div class="col-md-4">
                <div class="metric-card card h-100 shadow-sm border-0">
                    <div class="card-body text-center p-4">
                        <div class="metric-icon bg-success-soft text-success mb-3">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3 class="metric-value text-success">
                            <i class="fas fa-check-circle"></i> Excellent
                        </h3>
                        <p class="metric-label mb-0">Safety Rating</p>
                        <div class="metric-trend text-success mt-2">
                            <i class="fas fa-star me-1"></i>
                            <span>Top performer</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- RECENT ACTIVITY SECTION -->
    <section class="py-5 bg-light">
        <div class="container">
            <div class="section-header text-center mb-5">
                <span class="section-badge">
                    <i class="fas fa-history me-1"></i> Activity
                </span>
                <h2 class="section-title">Recent Activity</h2>
                <p class="section-subtitle">Latest updates from your sites</p>
            </div>
            
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="activity-feed" id="activityFeed">
                        <!-- Activity items will be loaded dynamically -->
                        <div class="text-center py-4" id="activityLoader">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="text-muted mt-2 mb-0">Loading activity...</p>
                        </div>
                    </div>
                    
                    <div class="text-center mt-4">
                        <a href="admin.html" class="btn btn-outline-primary" id="viewAllActivityBtn">
                            View All Activity <i class="fas fa-arrow-right ms-2"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- QUICK ACTIONS SECTION -->
    <section class="py-5">
        <div class="container">
            <div class="section-header text-center mb-5">
                <span class="section-badge">
                    <i class="fas fa-bolt me-1"></i> Quick Actions
                </span>
                <h2 class="section-title">Get Started</h2>
                <p class="section-subtitle">Common tasks to keep your site safe</p>
            </div>
            
            <div class="row g-4">
                <div class="col-md-6 col-lg-3">
                    <a href="photos.html" class="quick-action-card text-decoration-none">
                        <div class="card border-0 shadow-sm h-100 text-center p-4">
                            <div class="action-icon mx-auto mb-3 bg-primary-soft text-primary">
                                <i class="fas fa-camera fa-2x"></i>
                            </div>
                            <h5>Upload Photos</h5>
                            <p class="text-muted small mb-0">Document site conditions</p>
                        </div>
                    </a>
                </div>
                <div class="col-md-6 col-lg-3">
                    <a href="report.html" class="quick-action-card text-decoration-none">
                        <div class="card border-0 shadow-sm h-100 text-center p-4">
                            <div class="action-icon mx-auto mb-3 bg-danger-soft text-danger">
                                <i class="fas fa-exclamation-circle fa-2x"></i>
                            </div>
                            <h5>Report Incident</h5>
                            <p class="text-muted small mb-0">File safety reports</p>
                        </div>
                    </a>
                </div>
                <div class="col-md-6 col-lg-3">
                    <a href="training.html" class="quick-action-card text-decoration-none">
                        <div class="card border-0 shadow-sm h-100 text-center p-4">
                            <div class="action-icon mx-auto mb-3 bg-success-soft text-success">
                                <i class="fas fa-book-open fa-2x"></i>
                            </div>
                            <h5>Start Training</h5>
                            <p class="text-muted small mb-0">Complete safety modules</p>
                        </div>
                    </a>
                </div>
                <div class="col-md-6 col-lg-3">
                    <a href="about.html" class="quick-action-card text-decoration-none">
                        <div class="card border-0 shadow-sm h-100 text-center p-4">
                            <div class="action-icon mx-auto mb-3 bg-warning-soft text-warning">
                                <i class="fas fa-phone-alt fa-2x"></i>
                            </div>
                            <h5>Contact Safety</h5>
                            <p class="text-muted small mb-0">Reach safety officers</p>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="footer bg-dark text-white pt-5 pb-4">
        <div class="container">
            <div class="row g-4">
                <div class="col-lg-4 mb-4">
                    <div class="footer-brand d-flex align-items-center mb-3">
                        <i class="fas fa-hard-hat me-2 text-warning fa-lg"></i>
                        <span class="h5 mb-0">PGH Risk & Safety</span>
                    </div>
                    <p class="text-muted small">
                        Professional safety management solutions for construction and industrial sites. 
                        Committed to zero accidents and 100% compliance.
                    </p>
                    <div class="social-links mt-3">
                        <a href="#" class="text-muted me-3" aria-label="LinkedIn"><i class="fab fa-linkedin fa-lg"></i></a>
                        <a href="#" class="text-muted me-3" aria-label="Twitter"><i class="fab fa-twitter fa-lg"></i></a>
                        <a href="#" class="text-muted" aria-label="Facebook"><i class="fab fa-facebook fa-lg"></i></a>
                    </div>
                </div>
                <div class="col-6 col-lg-2">
                    <h6 class="text-uppercase mb-3">Quick Links</h6>
                    <ul class="list-unstyled footer-links">
                        <li><a href="index.html">Dashboard</a></li>
                        <li><a href="photos.html">Photos</a></li>
                        <li><a href="training.html">Training</a></li>
                        <li><a href="report.html">Reports</a></li>
                    </ul>
                </div>
                <div class="col-6 col-lg-2">
                    <h6 class="text-uppercase mb-3">Resources</h6>
                    <ul class="list-unstyled footer-links">
                        <li><a href="#">OSHA Guidelines</a></li>
                        <li><a href="#">Safety Manual</a></li>
                        <li><a href="#">FAQs</a></li>
                        <li><a href="about.html">Contact</a></li>
                    </ul>
                </div>
                <div class="col-lg-4">
                    <h6 class="text-uppercase mb-3">Emergency Contact</h6>
                    <div class="emergency-contact bg-danger bg-opacity-10 rounded p-3">
                        <p class="mb-2 small">
                            <i class="fas fa-phone-alt me-2 text-danger"></i>
                            <strong>Safety Officer:</strong> (555) 123-4567
                        </p>
                        <p class="mb-2 small">
                            <i class="fas fa-ambulance me-2 text-danger"></i>
                            <strong>Emergency:</strong> 911
                        </p>
                        <p class="mb-0 small">
                            <i class="fas fa-envelope me-2 text-danger"></i>
                            <strong>Email:</strong> safety@pghrisks.com
                        </p>
                    </div>
                </div>
            </div>
            <hr class="my-4 border-secondary">
            <div class="row align-items-center">
                <div class="col-md-6 text-center text-md-start">
                    <p class="small text-muted mb-0">
                        © 2026 PGH Risk & Safety. All rights reserved.
                    </p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <a href="#" class="small text-muted me-3">Privacy Policy</a>
                    <a href="#" class="small text-muted me-3">Terms of Service</a>
                    <a href="#" class="small text-muted">Accessibility</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button id="backToTop" class="btn btn-primary btn-back-to-top shadow" aria-label="Back to top">
        <i class="fas fa-chevron-up"></i>
    </button>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/api.js"></script>
    <script src="script.js"></script>
    <script>
        // Enhanced dashboard initialization with API integration
        document.addEventListener('DOMContentLoaded', async () => {
            // Update auth button based on login state
            updateAuthButton();
            
            // Load dynamic data if API is available
            await loadDashboardData();
        });
        
        function updateAuthButton() {
            const container = document.getElementById('authButtonContainer');
            if (!container) return;
            
            if (typeof API !== 'undefined' && API.auth.isAuthenticated()) {
                const user = API.auth.getCurrentUser();
                container.innerHTML = `
                    <div class="dropdown">
                        <button class="btn btn-warning btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user me-1"></i> ${user?.firstName || 'User'}
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            ${['admin', 'manager'].includes(user?.role) ? 
                                '<li><a class="dropdown-item" href="admin.html"><i class="fas fa-tachometer-alt me-2"></i>Admin Dashboard</a></li><li><hr class="dropdown-divider"></li>' : ''}
                            <li><a class="dropdown-item" href="#" id="profileLink"><i class="fas fa-user me-2"></i>My Profile</a></li>
                            <li><a class="dropdown-item" href="#" id="logoutLink"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                        </ul>
                    </div>
                `;
                
                // Logout handler
                document.getElementById('logoutLink')?.addEventListener('click', async (e) => {
                    e.preventDefault();
                    await API.auth.logout();
                    window.location.reload();
                });
            } else {
                container.innerHTML = `
                    <a href="login.html" class="btn btn-warning btn-sm">
                        <i class="fas fa-sign-in-alt me-1"></i> Login
                    </a>
                `;
            }
        }
        
        async function loadDashboardData() {
            // Only load from API if authenticated
            if (typeof API === 'undefined' || !API.auth.isAuthenticated()) {
                // Show demo data
                loadDemoActivity();
                return;
            }
            
            try {
                // Load real data from API
                const [stats, activity] = await Promise.all([
                    API.dashboard.getStats().catch(() => null),
                    API.dashboard.getActivity(5).catch(() => null)
                ]);
                
                // Update metrics if stats available
                if (stats) {
                    updateMetrics(stats);
                }
                
                // Update activity feed
                if (activity && activity.length > 0) {
                    renderActivityFeed(activity);
                } else {
                    loadDemoActivity();
                }
                
            } catch (error) {
                console.log('Using demo data:', error.message);
                loadDemoActivity();
            }
        }
        
        function updateMetrics(stats) {
            // Update metric cards with real data
            const incidents = document.querySelector('.metric-value.text-primary.counter');
            if (incidents && stats.incidents) {
                incidents.dataset.target = stats.incidents.thisMonth || 0;
            }
            
            const nearMisses = document.querySelector('.metric-value.text-warning.counter');
            if (nearMisses && stats.incidents) {
                nearMisses.dataset.target = stats.incidents.nearMisses || 0;
            }
        }
        
        function renderActivityFeed(activities) {
            const feed = document.getElementById('activityFeed');
            if (!feed) return;
            
            feed.innerHTML = activities.map(item => {
                const config = getActivityConfig(item.type);
                return `
                    <div class="activity-item card border-0 shadow-sm mb-3">
                        <div class="card-body d-flex align-items-start">
                            <div class="activity-icon ${config.bgClass} ${config.textClass} me-3">
                                <i class="fas ${config.icon}"></i>
                            </div>
                            <div class="activity-content flex-grow-1">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="mb-1">${escapeHtml(item.title)}</h6>
                                        <p class="text-muted mb-0 small">${escapeHtml(item.description || '')}</p>
                                    </div>
                                    <span class="badge ${config.badgeClass}">${formatTimeAgo(item.timestamp)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function loadDemoActivity() {
            const feed = document.getElementById('activityFeed');
            if (!feed) return;
            
            const demoActivities = [
                { type: 'incident', title: 'Incident Report #1042', description: 'Slip hazard reported at Site A', timestamp: new Date() },
                { type: 'photo', title: 'Photo Uploaded – Site B', description: 'Pre-task safety inspection photos', timestamp: new Date(Date.now() - 86400000) },
                { type: 'training', title: 'Training Completed – OSHA 10', description: 'Employee certification updated', timestamp: new Date(Date.now() - 259200000) }
            ];
            
            renderActivityFeed(demoActivities);
        }
        
        function getActivityConfig(type) {
            const configs = {
                incident: { icon: 'fa-file-alt', bgClass: 'bg-danger-soft', textClass: 'text-danger', badgeClass: 'bg-danger-soft text-danger' },
                photo: { icon: 'fa-camera', bgClass: 'bg-success-soft', textClass: 'text-success', badgeClass: 'bg-secondary-soft text-secondary' },
                training: { icon: 'fa-graduation-cap', bgClass: 'bg-info-soft', textClass: 'text-info', badgeClass: 'bg-secondary-soft text-secondary' },
                user: { icon: 'fa-user', bgClass: 'bg-primary-soft', textClass: 'text-primary', badgeClass: 'bg-secondary-soft text-secondary' },
                document: { icon: 'fa-file', bgClass: 'bg-warning-soft', textClass: 'text-warning', badgeClass: 'bg-secondary-soft text-secondary' }
            };
            return configs[type] || configs.incident;
        }
        
        function formatTimeAgo(date) {
            const d = new Date(date);
            const now = new Date();
            const diff = Math.floor((now - d) / 1000);
            
            if (diff < 60) return 'Just now';
            if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
            if (diff < 604800) return `${Math.floor(diff / 86400)}d ago`;
            return d.toLocaleDateString();
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text || '';
            return div.innerHTML;
        }
    </script>
</body>
</html>